# CLAUDE.md

このファイルは、Claude Code (claude.ai/code) がこのリポジトリで作業する際のガイダンスを提供します。

## プロジェクト概要

Pantriは、献立計画、食材管理、買い物リスト生成をサポートする料理・買い物支援Webアプリケーションです。食品廃棄を減らし、バランスの取れた食事を提案することを目的としています。

## 使い方

### 基本的な使用フロー

1. **初期設定**
   - アカウント登録・ログイン
   - 家族構成や食の好み設定
   - アレルギー情報の登録

2. **食材の登録・管理**
   - 冷蔵庫の食材を写真撮影して自動認識
   - 手動で食材名・数量・消費期限を入力
   - 在庫状況をリアルタイムで確認

3. **献立計画**
   - 現在の食材在庫を確認
   - 希望する調理時間や栄養バランスを設定
   - AIレコメンドエンジンが最適な献立を提案
   - 提案された献立から選択・調整

4. **買い物リスト生成**
   - 選択した献立に必要な食材を自動計算
   - 現在の在庫を除外して不足分を表示
   - 買い物リストを家族間で共有

5. **調理・消費管理**
   - 使用した食材の在庫を自動更新
   - 余った食材を使い切るレシピを提案
   - 消費期限アラートで食品廃棄を防止

### 主な操作画面

- **ダッシュボード**: 在庫状況、今日の献立、期限切れ近い食材を一覧表示
- **食材管理**: 冷蔵庫内の食材一覧・編集・写真登録
- **献立プランナー**: 週間献立の計画・編集・レシピ詳細
- **買い物リスト**: 必要な食材リスト・購入チェック・共有機能
- **レシピ検索**: 食材・調理時間・栄養素での絞り込み検索

### 主要機能
- **献立レコメンドエンジン**: 利用可能な食材、調理時間、栄養バランス、季節要因に基づいて献立を提案
- **スマート冷蔵庫管理**: 写真ベースの食材認識と消費期限追跡
- **インテリジェント買い物リスト**: 献立から買い物リストを自動生成し、既存の食材を除外
- **家族共有**: 家族間で献立と買い物リストを共有
- **食品廃棄削減**: 余った食材を使い切るレシピを提案

## 技術スタック

- **フロントエンド**: Next.js 15.3.4 with TypeScript
- **バックエンド**: AWS Amplify Gen2 (予定)
- **データベース**: Amazon RDS (PostgreSQL) (予定)
- **認証**: Amazon Cognito (予定)
- **ファイルストレージ**: Amazon S3 (食材写真用) (予定)
- **スタイリング**: Tailwind CSS v4, shadcn/ui

## 開発コマンド

### 基本コマンド
- `npm run dev` - Turbopackを使用した開発サーバー起動
- `npm run build` - 本番用ビルド
- `npm run start` - 本番サーバー起動
- `npm run lint` - ESLint実行

### 開発サーバー
開発サーバーは http://localhost:3000 で動作し、より高速なコンパイルのためTurbopackを使用します。

## アーキテクチャ

このアプリケーションは、AWSサービスを使用したサーバーレスアーキテクチャに従います：

### データフロー
1. ユーザーはCognitoを介して認証
2. 食材写真はS3と外部認識APIを通じて処理
3. 献立レコメンドエンジンが利用可能な食材とユーザー設定を分析
4. 献立要件と現在の在庫を比較して買い物リストを生成
5. 家族共有はセキュアなリンクベースのアクセス制御を使用

### 主要コンポーネント
- **食材認識**: 写真ベースの食材識別のための外部API統合
- **レコメンドアルゴリズム**: 食材、好み、栄養、タイミングを考慮した複合ロジック
- **在庫管理**: 食材の数量と消費期限のリアルタイム追跡
- **共有システム**: アクセス権限付きのリンクベース共有

## 開発フェーズ

### フェーズ1（MVP）
コア機能: 認証、基本UI、献立レコメンド、食材管理、買い物リスト

### フェーズ2（機能拡張）
家族プロフィール、余り物レシピ提案、通知

### フェーズ3（最適化）
PWAサポート、パフォーマンス最適化、分析

## 主要開発領域

### フロントエンド優先順位
1. 認証UI
2. 基本レイアウトとナビゲーション
3. 献立レコメンドインターフェース
4. 食材管理インターフェース
5. 買い物リストインターフェース

### バックエンド優先順位
1. AWSインフラストラクチャセットアップ
2. データベーススキーマ設計
3. 認証API
4. 食材管理API
5. レシピ管理API
6. 献立レコメンドエンジン
7. 買い物リストAPI

## TypeScript設定

プロジェクトは厳密なTypeScript設定を使用：
- Target: ES2017
- Module resolution: bundler
- パス マッピング: `@/*` はプロジェクトルートにマップ
- JSX: preserve (Next.js用)

## 重要な考慮事項

- **レスポンシブデザイン**: PC、タブレット、スマートフォンで動作する必要がある
- **画像処理**: 食材認識には注意深いAPI統合が必要
- **データプライバシー**: 個人の食事データは適切に保護する必要がある
- **パフォーマンス**: レシピレコメンドアルゴリズムには最適化が必要
- **国際化**: コンテンツは日本語
- **UI言語**: アプリケーションのインターフェースとコンテンツは主に日本語

## Next.jsの原則

### 1. コア原則
- App Router を標準採用
- TypeScript 必須（ESLint／型エラーは常にゼロ）
- API Routes は使用しない。あらゆるサーバー処理は Server Actions で実装

### 2. ディレクトリ構成

```
pantri/
├── app/                          # Next.js App Router - ページとルーティング
│   ├── (auth)/                   # 認証関連ルートグループ - ログイン・登録
│   │   ├── login/                # ログインページ
│   │   └── register/             # 新規登録ページ
│   ├── (dashboard)/              # メイン機能ルートグループ
│   │   ├── dashboard/            # ダッシュボード
│   │   ├── ingredients/          # 食材管理
│   │   │   ├── add/              # 食材追加（写真認識）
│   │   │   └── [id]/             # 個別食材詳細
│   │   ├── meal-planning/        # 献立プランナー
│   │   │   ├── weekly/           # 週間献立
│   │   │   └── recommendations/  # AI推奨献立
│   │   ├── shopping-lists/       # 買い物リスト
│   │   │   └── [id]/
│   │   ├── recipes/              # レシピ検索・管理
│   │   │   ├── search/
│   │   │   └── [id]/
│   │   └── family/               # 家族共有設定
│   ├── about/                    # aboutページ - サービス紹介
│   ├── contact/                  # お問い合わせページ
│   ├── privacy/                  # プライバシーポリシーページ
│   ├── terms/                    # サービス規約ページ
│   └── api/                      # 外部API統合 - 食材認識APIなど
├── features/                     # 機能別モジュール（Feature-based）- 各機能の完全な実装
│   ├── auth/                     # 認証機能 - ログイン・登録・セッション管理
│   │   ├── components/           # 認証フォーム、ガードコンポーネント
│   │   ├── actions/              # 認証関連のServer Actions
│   │   ├── types/                # 認証関連の型定義
│   │   └── hooks/                # 認証状態管理フック
│   ├── ingredients/              # 食材管理機能 - 登録・編集・写真認識・期限管理
│   │   ├── components/           # 食材リスト、カード、フォーム、スキャナー
│   │   ├── actions/              # 食材CRUD操作のServer Actions
│   │   ├── types/                # 食材データの型定義
│   │   └── hooks/                # 食材データ取得・操作フック
│   ├── meal-planning/            # 献立プランニング機能 - AI推奨・週間カレンダー
│   │   ├── components/           # 献立プランナー、カレンダー、栄養サマリー
│   │   ├── actions/              # 献立作成・更新のServer Actions
│   │   ├── types/                # 献立・レシピの型定義
│   │   └── hooks/                # 献立データ管理・AI連携フック
│   ├── shopping/                 # 買い物リスト機能 - 自動生成・共有・チェック
│   │   ├── components/           # 買い物リスト、アイテム、自動生成機能
│   │   ├── actions/              # 買い物リスト操作のServer Actions
│   │   ├── types/                # 買い物リストの型定義
│   │   └── hooks/                # 買い物リストデータ管理フック
│   ├── recipes/                  # レシピ機能 - 検索・フィルタ・詳細表示
│   │   ├── components/           # レシピ検索、カード、詳細、フィルター
│   │   ├── actions/              # レシピ検索・取得のServer Actions
│   │   ├── types/                # レシピデータの型定義
│   │   └── hooks/                # レシピデータ取得・検索フック
│   ├── family/                   # 家族共有機能 - メンバー管理・設定共有
│   │   ├── components/           # 家族設定、メンバー管理、共有設定
│   │   ├── actions/              # 家族データ管理のServer Actions
│   │   ├── types/                # 家族・メンバーの型定義
│   │   └── hooks/                # 家族データ管理フック
│   └── about/                    # aboutページ機能 - サービス紹介・説明
│       ├── components/           # aboutページ専用コンポーネント
│       │   ├── sections/         # ヒーロー、機能紹介、使い方セクション
│       │   ├── cards/            # 機能カード、使い方カード
│       │   └── ui/               # ステップ矢印などのUI要素
│       └── types/                # aboutページの型定義
├── shared/                       # 共通モジュール - 複数機能で使用する汎用コンポーネント
│   ├── components/               # 機能横断で使用するコンポーネント
│   │   ├── ui/                   # shadcn/ui + カスタムUI - Button, Card, Input等
│   │   └── layout/               # レイアウトコンポーネント - Header, Footer, Nav
│   ├── hooks/                    # 共通カスタムフック - localStorage, debounce, API等
│   └── types/                    # 共通型定義 - API response, common interfaces
├── lib/                          # ユーティリティとヘルパー - 共通ライブラリ機能
│   ├── services/                 # 外部サービス統合 - API連携・SDK
│   │   ├── aws/                  # AWS SDK統合 - S3, Cognito, RDS
│   │   ├── image-recognition/    # 食材認識API - 写真解析サービス
│   │   └── recommendation/       # 献立推奨エンジン - AI・機械学習
│   ├── db/                       # データベース関連 - ORM・クエリ・スキーマ
│   │   ├── schema/               # データベーススキーマ定義
│   │   ├── queries/              # 共通クエリ関数
│   │   └── migrations/           # データベースマイグレーション
│   ├── validations/              # Zodスキーマ - バリデーションルール
│   └── utils/                    # ユーティリティ関数 - 汎用ヘルパー
└── public/                       # 静的ファイル - 画像、アイコン、フォント
    ├── images/                   # 一般画像 - ロゴ、背景画像
    │   ├── ingredients/          # デフォルト食材画像 - 食材アイコン・写真
    │   └── recipes/              # レシピ画像 - 料理写真・サムネイル
    ├── icons/                    # アイコンファイル - SVG、PNG
    └── about/                    # aboutページ専用画像 - ヒーロー画像、ステップ画像
```

### 3. データハンドリング

| 依存条件 | 実装方法 |
|---------|---------|
| ユーザー操作に依存しない | server components + Server Actions |
| ユーザー操作に依存する | client components + Server Actions + useSWR |

- 更新は Server Actions、即時反映は useSWR.mutate で楽観的更新
- 認証基盤にはAmazon Cognitoを使用し、Cognitoを利用する実装にはAWS SDKを使用する。

### 4. 表示と状態管理
- UI は極力自作せず、必ず shadcn/ui のコンポーネントを利用
- アイコンは lucide-react を統一使用
- URL 状態は nuqs に統一
- グローバル状態ライブラリは 使用しない（必要時は React Context + useReducer などで最小構成）

### 5. パフォーマンス
- use client / useEffect / useState は最小限、まず RSC
- クライアント側は Suspense でフォールバック
- 動的 import で遅延読み込み、画像は next/image、リンクは next/link
- ルートベースのコード分割を徹底

### 6. フォームとバリデーション
- 制御コンポーネント + react-hook-form
- スキーマ検証は Zod
- クライアント／サーバー両方で入力チェック

### 7. 品質・セキュリティ・テスト

#### 7-1 エラーハンドリング
- ガード節で 早期 return、成功パスは最後にまとめる

#### 7-2 アクセシビリティ
- セマンティック HTML + ARIA、キーボード操作サポート

#### 7-3 Server Actions のセキュリティ指針
- ユーザーが許可された操作だけを Server Action として実装
- 汎用的・多目的なサーバー関数は実装しない

#### 7-4 テスト
- demo/ ディレクトリ に UI ベースのテストページを配置し、すべての Server Actions・クライアント関数を ブラウザ経由で手動検証 できるようにする

### 実装フロー
1. 設計：コア原則とディレクトリ決定
2. データ：取得（useSWR）・更新（Server Actions＋mutate）ルール確立
3. UI / State：shadcn/ui と lucide-react を使い、URL 状態は nuqs
4. パフォーマンス：RSC・Suspense・dynamic import で最適化
5. フォーム & バリデーション：Zod × react-hook-form
6. 品質管理：エラー処理 → アクセシビリティ → 専用 Server Actions → demo/ で手動テスト

## 開発ルール
- コミットメッセージは日本語で書く。また、以下のコミットタイトルをコミットメッセージの前に付ける。
  - fix：修正
  - add：機能追加
  - change：仕様変更（removeする場合もchange）
  - clean：整理（リファクタリング等）
  - upgrade：バージョンアップ
  - revert：変更取り消し
    - 例: `add: brandモデルに◯◯メソッドを追加`
- コンポーネントのインポート時は必ず `@/` プレフィックスを使用した絶対パスで参照する
  - 例: `import { Button } from "@/shared/components/ui/button"`
  - 相対パス（`./` や `../`）は使用しない（同一ディレクトリ内の場合を除く）